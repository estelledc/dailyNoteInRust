## MMU
内存管理单元**Memory Management Unit​**​
	涉及地址转换，内存保护，缓存管理
	操作系统通过配置MMU（如设置页表）实现进程隔离、内存分配等功能

## RISC-V satp寄存器
**Supervisor Address Translation and Protection**
`satp` 是 RISC-V ​**​S 特权级（Supervisor Mode）​**​ 的关键控制状态寄存器（CSR），用于配置和管理 ​**​MMU（内存管理单元）​**​ 的地址转换机制。它决定了 CPU 如何将 ​**​虚拟地址（VA）​**​ 转换为 ​**​物理地址（PA）​**​，并控制内存访问权限。

MODE（4 bit）+ASID（16 bit）+PPN（44 bit）

**`MODE=8`​**​：开 Sv39 分页，虚拟地址转换，支持多进程隔离，但需页表管理。
Bare 模式是“直接开车”，Sv39 是“用导航仪（MMU）找路”，导航出错时会报警（异常）。
## 地址相关的数据结构抽象与类型定义

| ​**​类型​**​    | ​**​含义​**​ | ​**​转换方式​**​      | ​**​用途​**​  |
| ------------- | ---------- | ----------------- | ----------- |
| `PhysAddr`    | 物理地址       | `PhysAddr(usize)` | 直接操作硬件内存    |
| `VirtAddr`    | 虚拟地址       | `VirtAddr(usize)` | 程序使用的指针     |
| `PhysPageNum` | 物理页号（PPN）  | `PhysAddr >> 12`  | 页表项、帧分配     |
| `VirtPageNum` | 虚拟页号（VPN）  | `VirtAddr >> 12`  | 页表查询、虚拟内存管理 |

## 页表项的数据结构抽象与类型定义
### ​**​SV39 分页模式下的页表项（Page Table Entry, PTE）详解​**​

在 RISC-V 的 ​**​Sv39 分页模式​**​ 下，页表项（PTE）是一个 ​**​64 位（8 字节）​**​ 的数据结构，用于描述 ​**​虚拟页到物理页的映射关系​**​ 以及 ​**​访问控制权限​**​。以下是其详细解析：

---

## ​**​ 页表项（PTE）的位域结构​**​

|​**​位域​**​|​**​字段名​**​|​**​宽度（bits）​**​|​**​作用​**​|
|---|---|---|---|
|​**​63:54​**​|Reserved|10|保留未用（未来扩展）|
|​**​53:10​**​|PPN[2:0]|44|​**​物理页号​**​（Physical Page Number），指向目标物理页的基地址|
|​**​9:8​**​|RSW|2|保留给操作系统使用（如页面替换算法标记）|
|​**​7​**​|D (Dirty)|1|​**​脏页标记​**​：页面是否被修改过（写操作后置 1）|
|​**​6​**​|A (Accessed)|1|​**​访问标记​**​：页面是否被访问过（读/写后置 1）|
|​**​5​**​|G|1|​**​全局页​**​（通常忽略）|
|​**​4​**​|U|1|​**​用户页​**​：U=1 时允许用户态（U 模式）访问|
|​**​3​**​|X (Execute)|1|​**​可执行权限​**​：X=1 允许执行（取指令）|
|​**​2​**​|W (Write)|1|​**​可写权限​**​：W=1 允许写入|
|​**​1​**​|R (Read)|1|​**​可读权限​**​：R=1 允许读取|
|​**​0​**​|V (Valid)|1|​**​有效位​**​：V=1 时页表项合法，否则触发缺页异常|

---
#### PTE关键字段

|​**​PTE 字段​**​|​**​作用​**​|​**​操作系统控制​**​|
|---|---|---|
|`PPN[2:0]`|存储物理页号，完成地址转换|分配/释放物理页|
|`R/W/X/U`|控制读写执行权限|隔离进程、保护内核|
|`V/A/D`|标记页面状态（有效、访问、脏页）|页面置换、脏页写回|

​**​PTE 是虚拟内存的核心枢纽​**​：  
硬件通过它完成地址转换，操作系统通过它实现内存隔离、权限控制和动态分配。

### PTE在从虚拟地址到物理地址中的作用
- CPU 访问虚拟地址 → MMU 查页表找到 PTE → 从 PTE 中提取 `PPN[2:0]` → 计算物理地址

```rust
    物理地址 = (PPN << 12) | (虚拟地址低12位)
```


## 缺页
